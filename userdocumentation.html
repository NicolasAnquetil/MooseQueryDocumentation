<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en"> <!--<![endif]-->
<head>
    <title>Moose Query Documentation - User Documentation</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Documentation of Moose Query, the query systeme of the Moose platform.">
    <meta name="author" content="Cyril Ferlicot-Delbecque">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="57x57" href="assets/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="assets/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="assets/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="assets/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="assets/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="assets/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="assets/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="assets/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="assets/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <!-- End Favicon -->

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
          rel='stylesheet' type='text/css'>
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="assets/plugins/prism/prism.css">
    <link rel="stylesheet" href="assets/plugins/elegant_font/css/style.css">

    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="assets/css/styles.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->
</head>

<body class="body-green">
<div class="page-wrapper">
    <!-- ******Header****** -->
    <header id="header" class="header">
        <div class="container">
            <div class="branding">
                <h1 class="logo">
                    <a href="index.html">
                        <span aria-hidden="true" class="icon_documents_alt icon"></span>
                        <span class="text-highlight">Moose</span><span class="text-bold">Query</span>
                    </a>
                </h1>
            </div><!--//branding-->
            <ol class="breadcrumb">
                <li><a href="index.html">Home</a></li>
                <li class="active">User Documentation</li>
            </ol>
        </div><!--//container-->
    </header><!--//header-->
    <div class="doc-wrapper">
        <div class="container">
            <div id="doc-header" class="doc-header text-center">
                <h1 class="doc-title"><i class="icon fa fa-user"></i> User Documentation</h1>
                <div class="meta"><i class="fa fa-clock-o"></i>Last updated: Jan 30th, 2018</div>
            </div><!--//doc-header-->
            <div class="doc-body">
                <div class="doc-content">
                    <div class="content-inner">
                        <section id="introduction" class="doc-section">
                            <h2 class="section-title">Introduction</h2>
                            <div class="section-block">
                                <p>
                                    Moose-Query is a domain-specific language to build queries for entities in <a
                                        href="http://www.moosetechnology.org/" class="text-highlight">Moose</a>. It
                                    succeeds to Moose-Chef. It is designed to simplify and standardize the way to query Moose
                                    models.
                                </p>
                                <figure class="section-image">
                                    <img src="assets/images/mse-graph.png" alt="Image representing a small model with containment and associations examples.">
                                    <figcaption>Example of an application model</figcaption>
                                </figure>
                                <p>
                                    An application model in Moose is composed of two concepts:
                                </p>
                                <dl>
                                    <dt>
                                        Imbrication of entities
                                    </dt>
                                    <dd>
                                       Defines which entity contains which entities. For example, it defines the classes contained in a package and the methods contained in a class. In the example image, it is the relations "parentPackage", "container", and "parentType". This concept allow to build the containment tree of a model.
                                    </dd>
                                    <br>
                                    <dt>
                                        Associations between entities
                                    </dt>
                                    <dd>
                                        Precise how the entities interact with each other. For example, an inheritance is an association between a subclass and its superclass. Another example is that a reference is an association between a behavioural entity and a type. In the example image, it can be the :Inheritance with the "superclass" and "subclass" relations.
                                    </dd>
                                </dl>
                                <p>
                                    MooseQuery allows exploring a model via those two concepts. Then, you can:
                                </p>
                                <ul>
                                    <li>Explore the containment tree</li>
                                    <li>Gather associations</li>
                                    <li>Manipulate the gathered associations</li>
                                    <li>Change the scope of entities (move from classes to the parent package or the children methods)</li>
                                </ul>
                                <p>
                                    In this documentation, we detail the use of the DSL. At the end, you will be able to query your Moose model, for example, to:
                                </p>
                                <ul>
                                    <li>Get the children of an entity (Exploration of the containment tree)</li>
                                    <li>Get all the associations contained in a class (Gathering of associations)</li>
                                    <li>Get all the entities who depend on a specific entity (Manipulation of the gathered associations)</li>
                                    <li>Get all the methods contained in a package in a Java model, including those in inner/anonymous classes (Change of scope)</li>
                                </ul>

                            </div>
                        </section>
                        <section id="containment-tree" class="doc-section">
                            <h2 class="section-title">Containment Tree Exploration</h2>
                            <div class="section-block">
                                <p>
                                    Navigate the containment tree is the easiest way to query a model. It is possible with the associations relations in the model. To do so, it exists a really simple API on entities:
                                </p>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Selector</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th scope="row">#children   </th>
                                            <td>Direct children of the entity</td></tr>
                                        <tr>
                                            <th scope="row">#parents   </th>
                                            <td>Direct parents of the entity</td></tr>
                                        <tr>
                                            <th scope="row">#allChildren   </th>
                                            <td>Children of the entity and their children recursively</td></tr>
                                        <tr>
                                            <th scope="row">#allParents   </th>
                                            <td>Parents of the entity and their parents recursively</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <figure style="text-align: center">
                                    <img src="assets/images/containmentTreeUser.png" alt="A schema of a containement tree">
                                    <figcaption>Example of a containment tree.</figcaption>
                                </figure>
                                <p>For example, the model in the example figure can be requested like that: </p>
                                <div class="code-block">
                                    <h6>Examples of Containment Tree Navigation</h6>
                                    <pre><code class="language-smalltalk">
package1 children. "=> { package2 . class1 }"
class3 children. "=> { attribute1 . attribute2 }"

package1 allChildren. "=> { package2 . class1 . class2 . class3 . attribute1 . attribute2 }"
class3 allChildren. "=> { attribute1 . attribute2 }"

package1 parents. "=> { }"
class3 parents. "=> { package2 }"
class4 parents. "=> { package3 . namespace1 }"

class3 allParents. "=> { package2 . package1 }"
attribute1 allParents. "=> { class3 . package2 . package1 }"
                                    </code></pre>
                                </div><!--//code-block-->
                            </div>
                        </section>
                        <section id="navigation" class="doc-section">
                            <h2 class="section-title">Navigation Queries</h2>
                            <div class="section-block">
                                <p>In order to navigate into the links between entities, MooseQuery provides a generic API to gather entities' associations. Those associations represent a different kind of links such as References, Inheritance, Accesses, or, for object-oriented languages, Invocations.
                                </p>
                                <p>
                                    These queries are configured with two parameters:
                                </p>
                                <ul>
                                    <li>
                                        The direction of the association (Incoming or Outgoing). An incoming association represents a relation where the studied entity (receiver of the query) is the target of the relation. An outgoing association represents a relation where the studied entity is the source of the relation.
                                    </li>
                                    <li>
                                        The association(s) that is queried
                                    </li>
                                </ul>
                                <p>
                                    On top of that, a query can be either local or not. A local query searches only in the associations of the receiver while a non-local query also gathers the entity children's associations. The main methods to perform those queries are:
                                </p>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                        <tr>
                                            <th>Selector</th>
                                            <th>Description</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th scope="row">#query:with:   </th>
                                            <td>This method takes as first parameter a symbol (#out or #in) to define the direction of the query and as second parameter an association class to query. <b>Return:</b> All the instances of this association class where the receiver or its children are the source/target depending on the symbol.</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">#queryAll:   </th>
                                            <td>This method takes as parameter a symbol (#out or #in) to define the direction of the query. It takes into account all kind of associations. <b>Return:</b> All the association's instances where the receiver or its children are the source/target depending on the symbol.</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">#queryLocal:with:   </th>
                                            <td>This method is equivalent to #query:with: but takes into account only the studied entity without its children. It takes as first parameter a symbol (#out or #in) to define the direction of the query and as second parameter an association class to query. <b>Return:</b> All the instances of this association class where the receiver only is the source/target depending on the symbol.</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">#queryAllLocal:   </th>
                                            <td>This method is equivalent to #queryAll: but takes into account only the studied entity without its children. It takes as parameter a symbol (#out or #in) to define the direction of the query. It takes into account all kind of associations. <b>Return:</b> All the association's instances where the receiver only is the source/target depending on the symbol.</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <figure style="text-align: center">
                                    <img src="assets/images/navigationUser.png" alt="A schema of a containment tree with relations">
                                    <figcaption>Example of a small model with associations.</figcaption>
                                </figure>
                                <p>For example, if we take the model present in the figure as an example we can do: </p>
                                <div class="code-block">
                                    <h6>Navigation Queries Examples</h6>
                                    <pre><code class="language-smalltalk">
class1 query: #in with: FAMIXInheritance. "=> { inheritance1 }"
class1 query: #out with: FAMIXInheritance. "=> { }"
class1 query: #out with: FAMIXAccess. "=> { access1 }. Method1 contained in Class1 access to Attribute1 via Access1, result of the query. The access is not directly done via Class1, but via its children."

class1 queryLocal: #in with: FAMIXInheritance. "=> { inheritance1 }"
class1 queryLocal: #out with: FAMIXAccess. "=> { }. No result because Class1 is not directly the source of Access1."

class1 queryAll: #in. "=> { inheritance1 . reference1 }"
class1 queryAll: #out. "=> { access1 }"

class1 queryAllLocal: #in. "=> { inheritance1 . reference1 }"
class1 queryAllLocal: #out. "=> { }"
                                    </code></pre>
                                </div><!--//code-block-->
                                <p>
                                    Now we can ask ourselves how to know which entity can be the source or target of which type of association. For this, it exists an API based on the meta-model of your application. These methods have to be sent to an entity class:
                                </p>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                        <tr>
                                            <th>Selector</th>
                                            <th>Description</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th scope="row">#outgoingAssociationTypes   </th>
                                            <td>Return all the possible outgoing association types for this entity. This does not include the outgoing association types of its possible children.</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">#incomingAssociationTypes   </th>
                                            <td>Return all the possible incoming association types for this entity. This does not include the incoming association types of its possible children.</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">#allOutgoingAssociationTypes   </th>
                                            <td>Return all the possible outgoing association types for this entity, including the outgoing association types of its possible children.</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">#allIncomingAssociationTypes   </th>
                                            <td>Return all the possible incoming association types for this entity, including the incoming association types of its possible children.</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="code-block">
                                    <h6>Association Types Queries Examples</h6>
                                    <pre><code class="language-smalltalk">
FAMIXType outgoingAssociationTypes. "=> { FAMIXInheritance }"
FAMIXType incomingAssociationTypes. "=> { FAMIXInheritance . FAMIXTraitUsage . FAMIXReference }"
FAMIXType allOutgoingAssociationTypes. "=> { FAMIXAccess . FAMIXInheritance . FAMIXInvocation . FAMIXReference }"
FAMIXType allIncomingAssociationTypes. "=> { FAMIXAccess . FAMIXInheritance . FAMIXInvocation . FAMIXReference . FAMIXTraitUsage }"
                                    </code></pre>
                                </div><!--//code-block-->
                            </div>
                        </section>
                        <section id="query-result" class="doc-section">
                            <h2 class="section-title">Query Result Handling</h2>
                            <div class="section-block">
                                <p>
                                    A navigation query returns a result as a MooseQueryResult. There are three types of query results:
                                </p>
                                <ul>
                                    <li>
                                        <b>MooseIncomingQueryResult</b> manages the result of a query on incoming associations.
                                    </li>
                                    <li>
                                        <b>MooseOutgoingQueryResult</b> manages the result of a query on outgoing associations.
                                    </li>
                                    <li>
                                        <b>MooseObjectQueryResult</b> is special kind of query result that can be obtained via the two others ones and includes the opposites of the receiver associations. (For example if you query the outgoing accesses of a class, the opposites of the class associations will be the accessed attributes)
                                    </li>
                                </ul>
                                <p>
                                    These query results classes are special collections with some new features.
                                </p>
                                <p>
                                    One of the most useful ones is the #opposites method present on MooseIncomingQueryResult and MooseOutgoingQueryResult. It returns a MooseObjectQueryResult containing all the opposites entities of the query result compared to the receiver of the query.
                                </p>
                                <p>
                                    Indeed, when we query a model, it is often not the associations that we want as result but the source/target entities of these associations. For example, if we want the instance variables accessed by a given method, #query:with: will returns the accesses whereas sending the message #opposites on the result returns the variables themselves.
                                </p>
                                <p>
                                    Taking the previous model as an example we can do:
                                </p>
                                <div class="code-block">
                                    <h6>Opposite query example</h6>
                                    <pre><code class="language-smalltalk">
class1 queryAll: #in. "=> { inheritance1 . reference1 }"
(class1 queryAll: #in) opposites. "=> { class2 . method2 }"
                                    </code></pre>
                                </div><!--//code-block-->
                                <p>
                                    Another possibility is to exclude all the results where the opposite is included in the receiver of the original query. This can be done via the method #withoutSelfLoop. It is handy when we want to query a model to find external dependencies without internal ones.
                                </p>
                                <p>
                                    Another feature is to be able to change the scope of the result. This feature is covered in the next section.
                                </p>
                            </div>
                        </section>
                        <section id="scope" class="doc-section">
                            <h2 class="section-title">Scoping Queries</h2>
                            <div class="section-block">
                                <p>
                                    Depending on the analysed we perform, it might be relevant to handle the queries at a different scope. For example, if we want to know the associations between a given class and all the other classes of the project, whatever the type of associations. The associations between classes can only be inheritance. But two classes are also linked if a method of one of them invoked a method of the other. It is necessary to consider the invocation at the scope of the class whereas it occur between some of their methods. Exactly the same occur for the other types of associations.
                                </p>
                                <p>
                                    For this scenario, it is possible to use the scope queries. A scope query can be applied to:
                                </p>
                                <ul>
                                    <li>
                                        A moose entity
                                    </li>
                                    <li>
                                        A MooseQueryResult obtained through a navigation query
                                    </li>
                                </ul>
                                <p>
                                    A scope query will have a direction to look for. You can look for entities higher, lower or both higher and lower than the receiver in the containment tree.
                                </p>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                        <tr>
                                            <th>Selector</th>
                                            <th>Parameter</th>
                                            <th>Description</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th scope="row">#atScope:   </th>
                                            <td>Famix class defining the scope of the query</td>
                                            <td>Return all the entities at this given famix class scope that are up in the containment tree of the metamodel.</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">#toScope:   </th>
                                            <td>Famix class defining the scope of the query</td>
                                            <td>Return all the entities at this given famix class scope that are down in the containment tree of the metamodel.</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">#withScope:   </th>
                                            <td>Famix class defining the scope of the query</td>
                                            <td>Return all the entities at this given famix class scope that are both up and down in the containment tree of the metamodel.</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <figure style="text-align: center">
                                    <img src="assets/images/scopeUser.png" alt="A schema of a containement tree">
                                    <figcaption>Example of a containment tree.</figcaption>
                                </figure>
                                <p>For example, if we take the model present in the figure as an example we can do: </p>
                                <div class="code-block">
                                    <h6>Scope Queries Examples</h6>
                                    <pre><code class="language-smalltalk">
package2 atScope: FAMIXPackage. "=> { package1 }"
package2 toScope: FAMIXPackage. "=> { }"
package2 withScope: FAMIXPackage. "=> { package1 }"

method1 atScope: FAMIXType. "=> { class3 }"
method1 toScope: FAMIXType. "=> { class4 }"
method2 withScope: FAMIXType. "=> { class3 . class4 }"
                                    </code></pre>
                                </div><!--//code-block-->
                            </div>
                        </section>
                        <section id="examples" class="doc-section">
                            <h2 class="section-title">Miscellaneous Examples</h2>
                            <div class="section-block">
                                <p>
                                    You will find here various example of the use of MooseQuery API.
                                </p>
                                <h3 class="question"><i class="fa fa-question-circle"></i>How do I get all the external entities a class depends on at a method level?</h3>
                                <div class="code-block">
                                    <pre><code class="language-smalltalk">
"Since #withScope: will takes the ooposites of the associations by itself, there is no need to call explicitly #opposites."
(aClass query: #out) withoutSelfLoop withScope: FAMIXMethod
                                    </code></pre>
                                </div><!--//code-block-->
                            </div>
                        </section>
                    </div><!--//content-inner-->
                </div><!--//doc-content-->
                <div class="doc-sidebar hidden-xs">
                    <nav id="doc-nav">
                        <ul id="doc-menu" class="nav doc-menu" data-spy="affix">
                            <li><a class="scrollto" href="#introduction">Introduction</a></li>
                            <li><a class="scrollto" href="#containment-tree">Containment Tree Exploration</a></li>
                            <li><a class="scrollto" href="#navigation">Navigation Queries</a></li>
                            <li><a class="scrollto" href="#query-result">Query Result Handling</a></li>
                            <li><a class="scrollto" href="#scope">Scoping Queries</a></li>
                            <li><a class="scrollto" href="#examples">Miscellaneous Examples</a></li>
                        </ul><!--//doc-menu-->
                    </nav>
                </div><!--//doc-sidebar-->
            </div><!--//doc-body-->
        </div><!--//container-->
    </div><!--//doc-wrapper-->


</div><!--//page-wrapper-->

<footer id="footer" class="footer text-center">
    <div class="container">
        <!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can check out other license options via our website: themes.3rdwavemedia.com */-->
        <small class="copyright">Designed with <i class="fa fa-heart"></i> by <a href="http://themes.3rdwavemedia.com/"
                                                                                 targe="_blank">Xiaoying Riley</a> for
            developers
        </small>

    </div><!--//container-->
</footer><!--//footer-->


<!-- Main Javascript -->
<script type="text/javascript" src="assets/plugins/jquery-1.12.3.min.js"></script>
<script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="assets/plugins/prism/prism.js"></script>
<script type="text/javascript" src="assets/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script>
<script type="text/javascript" src="assets/plugins/jquery-match-height/jquery.matchHeight-min.js"></script>
<script type="text/javascript" src="assets/js/main.js"></script>

</body>
</html>
